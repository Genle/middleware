{"version":3,"file":"moltin.cjs.js","sources":["../node_modules/uuid/lib/bytesToUuid.js","../node_modules/uuid/v4.js","../src/utils/helpers.js","../src/config.js","../src/factories/storage.js","../node_modules/uuid/lib/rng-browser.js","../src/factories/request.js","../src/extends/base.js","../src/extends/catalogue.js","../src/endpoints/products.js","../src/endpoints/currencies.js","../src/endpoints/brands.js","../src/endpoints/cart.js","../src/endpoints/categories.js","../src/endpoints/collections.js","../src/endpoints/orders.js","../src/endpoints/gateways.js","../src/endpoints/customers.js","../src/moltin.js"],"sourcesContent":["/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import uuidv4 from 'uuid/v4';\nimport StorageFactory from '../factories/storage';\n\nexport function buildRelationshipData(type, ids) {\n  let data = [];\n\n  if (ids === null || ids.length === 0) {\n    return [];\n  }\n\n  if (typeof ids === 'string') {\n    return [{\n      type,\n      id: ids,\n    }];\n  }\n\n  if (Array.isArray(ids)) {\n    data = ids.map(id => ({\n      type,\n      id,\n    }));\n  }\n\n  return data;\n}\n\nexport function cartIdentifier() {\n  const storage = new StorageFactory();\n  const cartId = uuidv4();\n\n  if (storage.get('mcart') !== null) {\n    return storage.get('mcart');\n  }\n\n  storage.set('mcart', cartId);\n\n  return cartId;\n}\n\nexport function parseJSON(response) {\n  if (response.status === 204) {\n    return new Promise((resolve) => {\n      resolve({\n        status: response.status,\n        ok: response.ok,\n        json: '{}',\n      });\n    });\n  }\n\n  return new Promise(resolve => response.json()\n  .then(json => resolve({\n    status: response.status,\n    ok: response.ok,\n    json,\n  })));\n}\n\nfunction formatFilterString(type, filter) {\n  const filterStringArray = Object.keys(filter).map((key) => {\n    const value = filter[key];\n\n    return `${type}(${key},${value})`;\n  });\n\n  return filterStringArray.join(':');\n}\n\nfunction formatQueryString(key, value) {\n  if (key === 'limit' || key === 'offset') {\n    return `page${(value)}`;\n  }\n\n  if (key === 'filter') {\n    const filterValues = Object.keys(value).map(\n      filter => formatFilterString(filter, value[filter]));\n\n    return `${key}=${filterValues.join(':')}`;\n  }\n\n  return `${key}=${value}`;\n}\n\nfunction buildQueryParams({ includes, sort, limit, offset, filter }) {\n  const query = {};\n\n  if (includes) {\n    query.include = includes;\n  }\n\n  if (sort) {\n    query.sort = `(${sort})`;\n  }\n\n  if (limit) {\n    query.limit = `[limit]=${limit}`;\n  }\n\n  if (offset) {\n    query.offset = `[offset]=${offset}`;\n  }\n\n  if (filter) {\n    query.filter = filter;\n  }\n\n  return Object.keys(query).map(k => formatQueryString(k, query[k])).join('&');\n}\n\nexport function buildURL(endpoint, params) {\n  if (params.includes || params.sort || params.limit || params.offset || params.filter) {\n    const paramsString = buildQueryParams(params);\n\n    return `${endpoint}?${paramsString}`;\n  }\n\n  return endpoint;\n}\n\nexport function buildRequestBody(body) {\n  let parsedBody;\n\n  if (body) {\n    parsedBody = `{\n      \"data\": ${JSON.stringify(body)}\n    }`;\n  }\n\n  return parsedBody;\n}\n\nexport function buildCartItemData(product, quantity, type = 'cart_item') {\n  return {\n    id: product,\n    type,\n    quantity: parseInt(quantity, 10),\n  };\n}\n","import { version } from '../package.json';\n\nclass Config {\n  constructor(options) {\n    const { application, client_id, client_secret, currency, host } = options;\n\n    this.application = application;\n    this.client_id = client_id;\n    this.client_secret = client_secret;\n    this.host = host || 'api.moltin.com';\n    this.protocol = 'https';\n    this.version = 'v2';\n    this.currency = currency;\n    this.auth = {\n      expires: 3600,\n      uri: 'oauth/access_token',\n    };\n    this.sdk = {\n      version,\n      language: 'JS',\n    };\n  }\n}\n\nexport default Config;\n","/* eslint no-undef: \"off\",\n          global-require: \"off\"\n*/\n\nclass StorageFactory {\n  constructor() {\n    if (typeof localStorage === 'undefined' || localStorage === null) {\n      const LocalStorage = require('node-localstorage').LocalStorage;\n\n      this.localStorage = new LocalStorage('./localStorage');\n    } else {\n      this.localStorage = window.localStorage;\n    }\n  }\n\n  set(key, value) {\n    return this.localStorage.setItem(key, value);\n  }\n\n  get(key) {\n    return this.localStorage.getItem(key);\n  }\n\n  delete(key) {\n    return this.localStorage.removeItem(key);\n  }\n}\n\nexport default StorageFactory;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n","import StorageFactory from './storage';\nimport { buildRequestBody, parseJSON } from '../utils/helpers';\n\nclass RequestFactory {\n  constructor(config) {\n    this.config = config;\n\n    this.storage = new StorageFactory();\n  }\n\n  authenticate() {\n    const { config, storage } = this;\n\n    if (!config.client_id) {\n      throw new Error('You must have a client_id set');\n    }\n\n    if (!config.host) {\n      throw new Error('You have not specified an API host');\n    }\n\n    const body = {\n      grant_type: config.client_secret ? 'client_credentials' : 'implicit',\n      client_id: config.client_id,\n    };\n\n    if (config.client_secret) {\n      body.client_secret = config.client_secret;\n    }\n\n    const promise = new Promise((resolve, reject) => {\n      fetch(`${config.protocol}://${config.host}/${config.auth.uri}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: Object.keys(body).map(k => `${encodeURIComponent(k)}=${encodeURIComponent(body[k])}`).join('&'),\n      })\n      .then(parseJSON)\n      .then((response) => {\n        if (response.ok) {\n          resolve(response.json);\n        }\n\n        reject(response.json);\n      })\n      .catch(error => reject(error));\n    });\n\n    promise.then((response) => {\n      storage.set('mtoken', response.access_token);\n      storage.set('mexpires', response.expires);\n    });\n\n    return promise;\n  }\n\n  send(uri, method, body = undefined) {\n    const { config, storage } = this;\n\n    const promise = new Promise((resolve, reject) => {\n      const req = () => {\n        const headers = {\n          Authorization: `Bearer: ${storage.get('mtoken')}`,\n          'Content-Type': 'application/json',\n          'X-MOLTIN-SDK-LANGUAGE': config.sdk.language,\n          'X-MOLTIN-SDK-VERSION': config.sdk.version,\n        };\n\n        if (config.application) {\n          headers['X-MOLTIN-APPLICATION'] = config.application;\n        }\n\n        if (config.currency) {\n          headers['X-MOLTIN-CURRENCY'] = config.currency;\n        }\n\n        /* eslint no-undef: \"off\" */\n        fetch(`${config.protocol}://${config.host}/${config.version}/${uri}`, {\n          method: method.toUpperCase(),\n          headers,\n          body: buildRequestBody(body),\n        })\n        .then(parseJSON)\n        .then((response) => {\n          if (response.ok) {\n            resolve(response.json);\n          }\n\n          reject(response.json);\n        })\n        .catch(error => reject(error));\n      };\n\n      if (!storage.get('mtoken') || Date.now().toString() >= storage.get('mexpires')) {\n        return this.authenticate()\n        .then(req)\n        .catch(error => reject(error));\n      }\n\n      return req();\n    });\n\n    return promise;\n  }\n}\n\nexport default RequestFactory;\n","import RequestFactory from '../factories/request';\nimport { buildURL } from '../utils/helpers';\n\nclass BaseExtend {\n  constructor(config) {\n    this.request = new RequestFactory(config);\n\n    this.config = config;\n  }\n\n  All() {\n    const { includes, sort, limit, offset, filter } = this;\n\n    this.call = this.request.send(buildURL(this.endpoint, {\n      includes,\n      sort,\n      limit,\n      offset,\n      filter,\n    }), 'GET');\n\n    return this.call;\n  }\n\n  Get(id) {\n    this.call = this.request.send(buildURL(`${this.endpoint}/${id}`, {\n      includes: this.includes,\n    }), 'GET');\n\n    return this.call;\n  }\n\n  Limit(value) {\n    this.limit = value;\n\n    return this;\n  }\n\n  Offset(value) {\n    this.offset = value;\n\n    return this;\n  }\n\n  Sort(value) {\n    this.sort = value;\n\n    return this;\n  }\n}\n\nexport default BaseExtend;\n","import BaseExtend from './base';\n\nclass CatalogueExtend extends BaseExtend {\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n\n  With(includes) {\n    if (includes) this.includes = includes.toString().toLowerCase();\n\n    return this;\n  }\n}\n\nexport default CatalogueExtend;\n","import { pluralize } from 'inflected';\nimport CatalogueExtend from '../extends/catalogue';\nimport { buildRelationshipData } from '../utils/helpers';\n\nclass ProductsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'products';\n  }\n\n  Filter(filter) {\n    this.filter = filter;\n\n    return this;\n  }\n\n  CreateRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'POST', body);\n  }\n\n  DeleteRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'DELETE', body);\n  }\n\n  UpdateRelationships(id, type, resources = null) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'PUT', body);\n  }\n}\n\nexport default ProductsEndpoint;\n","import BaseExtend from '../extends/base';\nimport StorageFactory from '../factories/storage';\n\nclass CurrenciesEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'currencies';\n    this.storage = new StorageFactory();\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n\n  Set(currency) {\n    const { config, storage } = this;\n\n    storage.set('mcurrency', currency);\n    config.currency = currency;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n\n  Active() {\n    const storage = this.storage;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n}\n\nexport default CurrenciesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass BrandsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'brands';\n  }\n}\n\nexport default BrandsEndpoint;\n","import BaseExtend from '../extends/base';\n\nimport { cartIdentifier, buildCartItemData } from '../utils/helpers';\n\nclass CartEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'carts';\n    this.cartId = cartIdentifier();\n  }\n\n  Get(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}`, 'GET');\n  }\n\n  Items(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'GET');\n  }\n\n  AddProduct(productId, quantity = 1, cartId = this.cartId) {\n    const body = buildCartItemData(productId, quantity);\n\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'POST', body);\n  }\n\n  AddCustomItem(body, cartId = this.cartId) {\n    const itemObject = Object.assign(body, {\n      type: 'custom_item',\n    });\n\n    return this.request.send(`${this.endpoint}/${cartId}/items`, 'POST', itemObject);\n  }\n\n  RemoveItem(itemId, cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/items/${itemId}`, 'DELETE');\n  }\n\n  UpdateItemQuantity(itemId, quantity, cartId = this.cartId) {\n    const body = buildCartItemData(itemId, quantity);\n\n    return this.request.send(`${this.endpoint}/${cartId}/items/${itemId}`, 'PUT', body);\n  }\n\n  Checkout(body, cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}/checkout`, 'POST', body);\n  }\n\n  Delete(cartId = this.cartId) {\n    return this.request.send(`${this.endpoint}/${cartId}`, 'DELETE');\n  }\n}\n\nexport default CartEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CategoriesEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'categories';\n  }\n\n  Tree() {\n    return this.request.send(`${this.endpoint}/tree`, 'GET');\n  }\n}\n\nexport default CategoriesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CollectionsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'collections';\n  }\n}\n\nexport default CollectionsEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass OrdersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'orders';\n  }\n\n  Items(id) {\n    return this.request.send(`${this.endpoint}/${id}/items`, 'GET');\n  }\n\n  Payment(id, body) {\n    return this.request.send(`${this.endpoint}/${id}/payments`, 'POST', body);\n  }\n  \n  Transactions(id) {\n    return this.request.send(`${this.endpoint}/${id}/transactions`, 'GET');\n  }\n  \n}\n\nexport default OrdersEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass GatewaysEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'gateways';\n  }\n\n  Update(slug, body) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', body);\n  }\n\n  Enabled(slug, enabled) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', {\n      type: 'gateway',\n      enabled,\n    });\n  }\n}\n\nexport default GatewaysEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass CustomersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'customers';\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n}\nexport default CustomersEndpoint;\n","import 'fetch-everywhere';\nimport 'es6-promise';\n\nimport Config from './config';\nimport RequestFactory from './factories/request';\nimport StorageFactory from './factories/storage';\nimport ProductsEndpoint from './endpoints/products';\nimport CurrenciesEndpoint from './endpoints/currencies';\nimport BrandsEndpoint from './endpoints/brands';\nimport CartEndpoint from './endpoints/cart';\nimport CategoriesEndpoint from './endpoints/categories';\nimport CollectionsEndpoint from './endpoints/collections';\nimport OrdersEndpoint from './endpoints/orders';\nimport GatewaysEndpoint from './endpoints/gateways';\nimport CustomersEndpoint from './endpoints/customers';\n\nexport default class Moltin {\n  constructor(config) {\n    this.config = config;\n    this.request = new RequestFactory(config);\n    this.storage = new StorageFactory();\n\n    this.Products = new ProductsEndpoint(config);\n    this.Currencies = new CurrenciesEndpoint(config);\n    this.Brands = new BrandsEndpoint(config);\n    this.Cart = new CartEndpoint(config);\n    this.Categories = new CategoriesEndpoint(config);\n    this.Collections = new CollectionsEndpoint(config);\n    this.Orders = new OrdersEndpoint(config);\n    this.Gateways = new GatewaysEndpoint(config);\n    this.Customers = new CustomersEndpoint(config);\n  }\n\n  // Expose `authenticate` function on the Moltin class\n  Authenticate() {\n    return this.request.authenticate();\n  }\n}\n\n// Export a function to instantiate the Moltin class\nconst gateway = config => new Moltin(new Config(config));\n\nexport { gateway };\n"],"names":["bytesToUuid","buf","offset","i","bth","byteToHex","v4","options","Array","rnds","random","rng","ii","buildRelationshipData","type","ids","let","data","length","id","isArray","map","cartIdentifier","const","storage","StorageFactory","cartId","uuidv4","get","set","parseJSON","response","status","Promise","resolve","ok","json","then","formatFilterString","filter","Object","keys","key","value","join","formatQueryString","buildQueryParams","ref","includes","sort","limit","query","include","k","buildURL","endpoint","params","buildRequestBody","body","parsedBody","JSON","stringify","buildCartItemData","product","quantity","parseInt","Config","application","client_id","client_secret","currency","host","this","protocol","version","auth","expires","uri","sdk","language","localStorage","LocalStorage","require","window","setItem","getItem","delete","removeItem","crypto","global","msCrypto","getRandomValues","rnds8","Uint8Array","r","Math","toString","substr","RequestFactory","config","authenticate","Error","grant_type","promise","reject","fetch","method","headers","Content-Type","encodeURIComponent","catch","error","access_token","send","undefined","req","Authorization","X-MOLTIN-SDK-LANGUAGE","X-MOLTIN-SDK-VERSION","toUpperCase","Date","now","BaseExtend","request","All","call","Get","Limit","Offset","Sort","CatalogueExtend","Create","Delete","Update","With","toLowerCase","ProductsEndpoint","super","Filter","CreateRelationships","resources","pluralize","DeleteRelationships","UpdateRelationships","CurrenciesEndpoint","Set","err","Active","BrandsEndpoint","CartEndpoint","Items","AddProduct","productId","AddCustomItem","itemObject","assign","RemoveItem","itemId","UpdateItemQuantity","Checkout","CategoriesEndpoint","Tree","CollectionsEndpoint","OrdersEndpoint","Payment","Transactions","GatewaysEndpoint","slug","Enabled","enabled","CustomersEndpoint","Moltin","Products","Currencies","Brands","Cart","Categories","Collections","Orders","Gateways","Customers","Authenticate","gateway"],"mappings":"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"}